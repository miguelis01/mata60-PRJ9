/* Tabela de Eventos */
CREATE TABLE TB_EVENTO (
    ID_EVENTO INT NOT NULL,
    DT_EVENTO DATE NOT NULL,          -- Prefixo DT_ (Seção 1)
    DS_LOCAL VARCHAR(255) NOT NULL,   -- Prefixo DS_ (Seção 1), tipo corrigido
    CONSTRAINT PK_EVENTO PRIMARY KEY (ID_EVENTO) -- Prefixo PK_ 
);

/* Tabela de Inscrições */
CREATE TABLE TB_INSCRICAO (
    ID_INSCRICAO INT NOT NULL 
        GENERATED BY DEFAULT AS IDENTITY 
        (START WITH 1 INCREMENT BY 1),
    CONSTRAINT PK_INSCRICAO PRIMARY KEY (ID_INSCRICAO) 
);

/* Tabela de Participantes */
CREATE TABLE TB_PARTICIPANTE (
    CD_CPF_PARTICIPANTE CHAR(11) NOT NULL,         -- CHAR(11), preserva zeros à esquerda
    DS_NOME VARCHAR(150) NOT NULL,                 -- Prefixo DS_
    DS_EMAIL VARCHAR(100) NOT NULL,                -- Prefixo DS_
    TP_CATEGORIA INT NOT NULL,                     -- Prefixo TP_
    ID_INSCRICAO INT NOT NULL,                     -- Prefixo ID_

    CONSTRAINT PK_PARTICIPANTE PRIMARY KEY (CD_CPF_PARTICIPANTE), -- Prefixo PK_
    CONSTRAINT UK_PARTICIPANTE_EMAIL UNIQUE (DS_EMAIL),           -- Prefixo UK_
    CONSTRAINT FK_PARTICIPANTE_INSCRICAO FOREIGN KEY (ID_INSCRICAO) REFERENCES TB_INSCRICAO (ID_INSCRICAO), -- Prefixo FK_

    -- Garante que o CPF tenha exatamente 11 dígitos numéricos
    CONSTRAINT CK_CPF_FORMATO CHECK (CD_CPF_PARTICIPANTE ~ '^[0-9]{11}$')
);

-- Garantir que o CPF no participante é único
ALTER TABLE TB_PARTICIPANTE
ADD CONSTRAINT UK_PARTICIPANTE_CPF UNIQUE (CD_CPF_PARTICIPANTE);

/* Tabela de Artigos */
CREATE TABLE TB_ARTIGO (
    ID_ARTIGO INT NOT NULL,
    DS_TITULO VARCHAR(250) NOT NULL, -- Prefixo DS_, tipo corrigido
    DS_RESUMO VARCHAR(4000),         -- Prefixo DS_, tipo corrigido
    DS_PATH_DOCUMENTO VARCHAR(500),  -- Prefixo DS_, tipo corrigido
    CONSTRAINT PK_ARTIGO PRIMARY KEY (ID_ARTIGO) -- PK obrigatória 
);

/* Tabela de Pagamentos */
CREATE TABLE TB_PAGAMENTO (
    ID_PAGAMENTO INT NOT NULL,
    CD_BOLETO VARCHAR(100) NOT NULL, -- Prefixo CD_, nome e tipo corrigidos
    DT_PAGAMENTO DATE,               -- Prefixo DT_, nome e tipo corrigidos
    VL_PAGAMENTO NUMERIC(10, 2) NOT NULL, -- Prefixo VL_, tipo corrigido
    ID_INSCRICAO INT NOT NULL,       -- Prefixo ID_
    CONSTRAINT PK_PAGAMENTO PRIMARY KEY (ID_PAGAMENTO), -- Prefixo PK_
    CONSTRAINT UK_PAGAMENTO_BOLETO UNIQUE (CD_BOLETO), -- Prefixo UK_
    CONSTRAINT FK_PAGAMENTO_INSCRICAO FOREIGN KEY (ID_INSCRICAO) REFERENCES TB_INSCRICAO (ID_INSCRICAO) -- Prefixo FK_
);

/* Tabela de Atividades */
CREATE TABLE TB_ATIVIDADE (
    ID_ATIVIDADE INT NOT NULL,
    DS_NOME_ATIVIDADE VARCHAR(200) NOT NULL, -- Prefixo DS_
    TP_CATEGORIA INT,                        -- Prefixo TP_
    CONSTRAINT PK_ATIVIDADE PRIMARY KEY (ID_ATIVIDADE) -- PK obrigatória 
);

/* Tabela Associativa: Artigo <-> Atividade */
CREATE TABLE RL_ARTIGO_ATIVIDADE (
    ID_ARTIGO INT NOT NULL,    -- Prefixo ID_
    ID_ATIVIDADE INT NOT NULL, -- Prefixo ID_
    CONSTRAINT PK_ARTIGO_ATIVIDADE PRIMARY KEY (ID_ARTIGO, ID_ATIVIDADE), -- PK Composta
    CONSTRAINT FK_RL_ARTIGO FOREIGN KEY (ID_ARTIGO) REFERENCES TB_ARTIGO (ID_ARTIGO), -- Prefixo FK_
    CONSTRAINT FK_RL_ATIVIDADE FOREIGN KEY (ID_ATIVIDADE) REFERENCES TB_ATIVIDADE (ID_ATIVIDADE) -- Prefixo FK_
);

/* Tabela Associativa: Participante <-> Atividade */
CREATE TABLE RL_PARTICIPANTE_ATIVIDADE (
    CD_CPF_PARTICIPANTE CHAR(11) NOT NULL, -- Prefixo CD_
    ID_ATIVIDADE INT NOT NULL,              -- Prefixo ID_
    CONSTRAINT PK_PARTICIPANTE_ATIVIDADE PRIMARY KEY (CD_CPF_PARTICIPANTE, ID_ATIVIDADE), -- PK Composta
    CONSTRAINT FK_RL_PARTICIPANTE FOREIGN KEY (CD_CPF_PARTICIPANTE) REFERENCES TB_PARTICIPANTE (CD_CPF_PARTICIPANTE),
    CONSTRAINT FK_RL_ATIVIDADE_PART FOREIGN KEY (ID_ATIVIDADE) REFERENCES TB_ATIVIDADE (ID_ATIVIDADE)
);

/* Tabela Associativa: Atividade <-> Evento */
CREATE TABLE RL_ATIVIDADE_EVENTO (
    ID_ATIVIDADE INT NOT NULL, -- Prefixo ID_
    ID_EVENTO INT NOT NULL,    -- Prefixo ID_
    CONSTRAINT PK_ATIVIDADE_EVENTO PRIMARY KEY (ID_ATIVIDADE, ID_EVENTO), -- PK Composta
    CONSTRAINT FK_RL_ATIVIDADE_EVT FOREIGN KEY (ID_ATIVIDADE) REFERENCES TB_ATIVIDADE (ID_ATIVIDADE),
    CONSTRAINT FK_RL_EVENTO_ATIV FOREIGN KEY (ID_EVENTO) REFERENCES TB_EVENTO (ID_EVENTO)
);
